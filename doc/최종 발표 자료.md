# 블랙잭

## 블랙잭 규칙

딜러와 플레이어는 카드를 두 장씩 받는다. 딜러는 첫 번째로 받은 카드를 플레이어에게 공개해야 하고 플레이어는 공개된 딜러의 카드를 고려하여 점수 21이 넘지 않으면서, 딜러보다 더 높은 점수를 얻는 것이 승리 조건이다.

A는 1 또는 11, J, Q, K는 10의 값을 가지고 나머지 카드는 표기된 숫자 만큼의 점수를 가진다.

![img](/doc/images/Blackjackdraw.gif)

## 타겟 시스템 최적화

### 파일 시스템을 활용한 배팅금 저장

시작할때마다 `money.txt` 파일에 접근하여 `money` 정수 변수에 파일에 저장된 값을 대입

```c
int money = 0;
FILE* file;

file = fopen("money.txt", "r");
fscanf(file, "%d", &money);
if(money > 9999) money = 9999;
fclose(file);
```

종료시 다음 함수 호출로 파일에 게임 이후 소지금 저장

```c
void Finish(bool over, int num) {
    FILE* file;
    int n;
    file = fopen("money.txt", "w");
    char fake[16];
    ResultPrint(n, fake, 8);

    if (over) {
        num = 900;
        fprintf(file, "%ld", num);
    }
    else {
        if(num > 9999) num = 9999;
        fprintf(file, "%ld", num);
    }
    fclose(file);
}
```

### A 카드 처리

A 카드는 1 또는 11중 하나의 값을 가진다.

딜러와 플레이어의 손패를 기억하는 배열을 생성

```c
char user_hand[16] = { ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '};
char dealer_hand[16] = { ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '};
```

카드 드로우마다 해당 배열에 알파벳 형태의 문양과 문자를 저장

문자를 저장하는 이유는 딜러의 카드를 LCD에 출력하기 위한 목적

![img](/doc/images/Handarray.png)

이후 Hit 상황에서 점수가 21을 넘으면 다음 함수를 출력

```c
bool HandCheck(char* arr, int *cnt) {
    int i = 0;
    int count = 0;
    for (i = 0; i < 16; i++) {
        if (arr[i] == 'A') {
            count++;
        }
    }
    if(count > *cnt) {
        *cnt = *cnt + 1;
        return true;
    }
    else {
        return false;
    }
}
```

`*cnt` 포인터 변수가 가리키는 값 보다 배열 내 A 카드의 개수가 더 많다면 `true`, 아니면 `false`를 반환하도록 구현

```c
if (dealer_score > 21) {
    if (HandCheck(dealer_hand, &dealer_ace_count)) dealer_score -= 10;
    else {
        dealer_bust = true;
        break;
    }
}
```


## 게임을 위한 장치

![img](/doc/images/Blackjackoverview.png)
### DotMatrix
유저가 카드를 뽑을 때마다 카드의 문양과 문자를 표현

### Tact Switch
맨 윗줄 3개의 스위치로 게임 진행 배팅과 힛/스탠드 결정

### FND
유저가 가진 소지금과 배팅금 연출 FND의 첫 번째 출력 부분이 고장났기에 기본 배팅금을 900원으로 설정

### LCD
윗 줄에 딜러의 카드를 문양과 문자 순으로 출력, 아랫 줄에 유저의 카드 합산 점수와 게임 안내 문구 출력

## 게임 영상

2분 정도 들어갈 예정 (영상에 에이스 처리, 올인, 게임오버, 배팅금 저장 들어가야 함)


# 참고 문헌

## "Blackjack", Youtube, https://www.youtube.com/watch?v=Nq048zl8elw&t=300&ab_channel=PerfectPair